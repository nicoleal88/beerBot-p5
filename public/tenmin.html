<!doctype html>
<html>

<head>
    <title>Line Chart - 10 minutes</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.bundle.js"></script>
    <style type="text/css">
        #canvas-holder {
            background-color: #FFFFFF;
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            bottom: 12px;
        }
    </style>
</head>

<body>
    <div id="canvas-holder">
        <canvas id="myChart"></canvas>
    </div>
    <br>
    <br>
    <script>
        // var timeFormat = 'MM/DD/YYYY HH:mm';

        async function getData() {
            const response = await fetch('/tenmin');
            const data = await response.json();
            // console.log(data);
            return data;
        }

        async function plotIt() {
            const data = await getData();
            let temp1 = []
            let temp2 = []
            let temp3 = []
            let timestamp = [];
            // console.log(data);
            for (item of data) {
                const t1 = item.t1;
                const t2 = item.t2;
                const t3 = item.t3;
                const t = new Date(item.timestamp)
                // const t = (item.timestamp)
                temp1.push({
                    t: t,
                    y: t1
                });
                temp2.push({
                    t: t,
                    y: t2
                });
                temp3.push({
                    t: t,
                    y: t3
                });
                timestamp.push(t.toLocaleString());
                // timestamp.push(t);
            }
            console.log(temp1);
            // console.log(timestamp);
            var ctx = document.getElementById("myChart").getContext("2d");
            var myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamp,
                    datasets: [{
                            label: "Fermentador 1",
                            data: temp1,
                            
                            borderColor: 'red'
                        },
                        {
                            label: "Fermentador 2",
                            data: temp2,
                            
                            borderColor: 'blue'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: "Chart.js Time Scale"
                    },
                    scales: {
                        xAxes: [{
                            type: "time",
                            scaleLabel: {
                                display: true,
                                labelString: 'Date'
                            }
                        }],
                        yAxes: [{
                            scaleLabel: {
                                display: true,
                                labelString: 'value'
                            }
                        }]
                    }
                }
            });
        }

        plotIt();
    </script>
</body>

</html>