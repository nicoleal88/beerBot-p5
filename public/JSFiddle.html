<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="refresh" content="60"><!-- Auto-update every x seconds -->
  <title>Registro de Temperaturas</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style id="compiled-css" type="text/css">
       #canvas-holder {
   background-color: #e2e2e2;
   position: absolute;
   top: 12px;
   left: 12px;
   right: 12px;
   bottom: 12px;
 }

    /* EOS */
  </style>

</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-colorschemes"></script>
    <div id="canvas-holder">
  <canvas id="hum1"></canvas>
</div>

    <script type="text/javascript">//<![CDATA[

async function getData() {
            const response = await fetch('/tenmin');
            const data = await response.json();
            // console.log(data);
            return data;
        };

// const data = [{
//     x: 1588281429.6027,
//     y: 700
//   },
//   {
//     x: 1588313430.6634,
//     y: 0
//   },
//   {
//     x: 1588323431.7241,
//     y: 0
//   },
//   {
//     x: 1588333432.7848,
//     y: 0
//   },
//   {
//     x: 1588343433.8455,
//     y: 400
//   },
//   {
//     x: 1588353434.9062,
//     y: 400
//   },
//   {
//     x: 1588353435.9668,
//     y: 400
//   },
//   {
//     x: 1588353437.0274,
//     y: 400
//   },
//   {
//     x: 1588353438.0881,
//     y: 400
//   },
//   {
//     x: 1588353439.1487,
//     y: 400
//   },
//   {
//     x: 1588353440.2093,
//     y: 400
//   },
//   {
//     x: 1588353441.27,
//     y: 400
//   },
//   {
//     x: 1588353442.3307,
//     y: 400
//   },
//   {
//     x: 1588353443.3929,
//     y: 400
//   },
//   {
//     x: 1588353444.4537,
//     y: 400
//   },
//   {
//     x: 1588353445.5142,
//     y: 400
//   },
//   {
//     x: 1588353723.1543,
//     y: 415
//   },
//   {
//     x: 1588353724.216,
//     y: 110
//   },
//   {
//     x: 1588353725.2782,
//     y: 230
//   },
//   {
//     x: 1588353726.3402,
//     y: 320
//   },
//   {
//     x: 1588353727.402,
//     y: 400
//   },
//   {
//     x: 1588353728.463,
//     y: 400
//   },
//   {
//     x: 1588353793.2418,
//     y: 415
//   },
//   {
//     x: 1588353794.304,
//     y: 220
//   },
//   {
//     x: 1588353795.3658,
//     y: 330
//   },
//   {
//     x: 1588353796.4265,
//     y: 220
//   },
//   {
//     x: 1588353797.4882,
//     y: 400
//   },
//   {
//     x: 1588353798.5495,
//     y: 400
//   },
//   {
//     x: 1588353799.6102,
//     y: 400
//   },
//   {
//     x: 1588353800.6715,
//     y: 400
//   },
//   {
//     x: 1588353801.7327,
//     y: 405
//   },
//   {
//     x: 1588353802.7933,
//     y: 400
//   },
//   {
//     x: 1588353803.8564,
//     y: 405
//   },
//   {
//     x: 1588353804.9154,
//     y: 405
//   },
//   {
//     x: 1588353805.9779,
//     y: 405
//   },
//   {
//     x: 1588859807.0411,
//     y: 411
//   }
// ];
// data.forEach((o) => o.x *= 1000);

// const data2 = [{
//     x: 1588281429.6027,
//     y: 700
//   },
//   {
//     x: 1588313430.6634,
//     y: 0
//   },
//   {
//     x: 1588323431.7241,
//     y: 0
//   },
//   {
//     x: 1588333432.7848,
//     y: 0
//   },
//   {
//     x: 1588343433.8455,
//     y: 400
//   },
//   {
//     x: 1588353434.9062,
//     y: 400
//   },
//   {
//     x: 1588353435.9668,
//     y: 400
//   },
//   {
//     x: 1588353437.0274,
//     y: 400
//   },
//   {
//     x: 1588353438.0881,
//     y: 400
//   },
//   {
//     x: 1588353439.1487,
//     y: 400
//   },
//   {
//     x: 1588353440.2093,
//     y: 400
//   },
//   {
//     x: 1588353441.27,
//     y: 400
//   },
//   {
//     x: 1588353442.3307,
//     y: 400
//   },
//   {
//     x: 1588353443.3929,
//     y: 400
//   },
//   {
//     x: 1588353444.4537,
//     y: 400
//   },
//   {
//     x: 1588353445.5142,
//     y: 400
//   },
//   {
//     x: 1588353723.1543,
//     y: 415
//   },
//   {
//     x: 1588353724.216,
//     y: 110
//   },
//   {
//     x: 1588353725.2782,
//     y: 230
//   },
//   {
//     x: 1588353726.3402,
//     y: 320
//   },
//   {
//     x: 1588353727.402,
//     y: 400
//   },
//   {
//     x: 1588353728.463,
//     y: 400
//   },
//   {
//     x: 1588353793.2418,
//     y: 415
//   },
//   {
//     x: 1588353794.304,
//     y: 220
//   },
//   {
//     x: 1588353795.3658,
//     y: 330
//   },
//   {
//     x: 1588353796.4265,
//     y: 220
//   },
//   {
//     x: 1588353797.4882,
//     y: 400
//   },
//   {
//     x: 1588353798.5495,
//     y: 400
//   },
//   {
//     x: 1588353799.6102,
//     y: 400
//   },
//   {
//     x: 1588353800.6715,
//     y: 400
//   },
//   {
//     x: 1588353801.7327,
//     y: 405
//   },
//   {
//     x: 1588353802.7933,
//     y: 400
//   },
//   {
//     x: 1588353803.8564,
//     y: 405
//   },
//   {
//     x: 1588353804.9154,
//     y: 405
//   },
//   {
//     x: 1588353805.9779,
//     y: 405
//   },
//   {
//     x: 1588859807.0411,
//     y: 411
//   }
// ];
// data2.forEach((o) => o.x *= 1000);
// data2.forEach((o) => o.y *= 1.5);

async function plotIt() {
            const data = await getData();
            let temp1 = []
            let temp2 = []
            let temp3 = []
            let timestamp = [];
            // console.log(data);
            for (item of data) {
                const t1 = item.t1;
                const t2 = item.t2;
                const t3 = item.t3;
                // const t = new Date(item.timestamp)
                const t = (item.timestamp)
                temp1.push({
                    x: t,
                    y: t1
                });
                temp2.push({
                    x: t,
                    y: t2
                });
                temp3.push({
                    x: t,
                    y: t3
                });
                // timestamp.push(t.toLocaleString());
                timestamp.push(t);
            }
            console.log(temp1);
            console.log(temp2);
            console.log(temp3);

new Chart(document.getElementById("hum1"), {
  type: 'scatter',
  data: {
    datasets: [{
      label: "Ferm. 1",
      // pointStyle: 'line',
      showLine: true,
      fill: false,
      // borderColor: '#999999',
      pointRadius: 3,
      pointHoverRadius: 6,
      data: temp1
    },
    {
      label: "Ferm. 2",
      // pointStyle: 'line',
      showLine: true,
      fill: false,
      // borderColor: '#999999',
      pointRadius: 3,
      pointHoverRadius: 6,
      data: temp2
    },
    {
      label: "Ferm. 3",
      // pointStyle: 'line',
      showLine: true,
      fill: false,
      // borderColor: '#999999',
      pointRadius: 3,
      pointHoverRadius: 6,
      data: temp3
    }
  ]
  },
  options: {
    tooltips: {
            position: "average",
						mode: 'index',
						intersect: false,
				},
				hover: {
					mode: 'index',
					intersect: false
				},
    plugins: {
            colorschemes: {
                scheme: 'brewer.PuOr9'
            }},
    responsive: true,
    maintainAspectRatio: false,
    legend: {
      position: 'bottom',
      labels: {
        usePointStyle: true
      }
    },
    scales: {
      xAxes: [{
        ticks: {
          maxTicksLimit: 10.1,
          sampleSize: 30
        },
        type: 'time',
        time: {
          unit: 'minute',
          displayFormats: {
            minute: 'DD/MM - HH:mm'
          },
          tooltipFormat: 'HH:mm'
        },
        scaleLabel: {
          display: true,
          labelString: 'Timestamp'
        }
      }],
      yAxes: [{
        display: true,
        ticks: {
          beginAtZero: false,
          steps: 10,
          stepValue: 5,
          //min: -30
        },
        scaleLabel: {
          display: true,
          labelString: 'Temp [C]'
        }
      }]
    },
    title: {
      display: true,
      text: 'Registro de Temperaturas'
    }
  }
});

}

plotIt();

  //]]></script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "7zub2fay"
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>


</body>
</html>
